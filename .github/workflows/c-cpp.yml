name: Bad Apple Build & Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install dependencies (fix apt warnings & missing package)
        run: |
          # 优化apt命令：-yq 自动确认+减少输出，消除稳定CLI警告
          sudo apt update -yq
          # 1. 基础编译工具（已存在但显式安装更稳妥）
          sudo apt install -yq gcc git make
          # 2. SDL2核心依赖：删除libSDL2-alsa-dev（新版已合并到libSDL2-dev）
          sudo apt install -yq libsdl2-dev
          # 3. ffmpeg（音视频转换必需）
          sudo apt install -yq ffmpeg

      - name: Build project
        run: |
          make clean
          make

      - name: Verify build success
        run: |
          echo "✅ 编译完成，产物信息："
          ls -l bad-apple-sync  # 验证可执行文件是否生成
