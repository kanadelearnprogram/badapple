name: Bad Apple Build & Test

# 触发条件：推送代码、提交PR时执行
on:
  push:
    branches: [ main ]  # 你的仓库主分支名，按需修改
  pull_request:
    branches: [ main ]

# 运行环境：选择最新的Ubuntu（兼容SDL2和ffmpeg）
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 步骤1：拉取仓库代码
      - name: Checkout code
        uses: actions/checkout@v4

      # 步骤2：安装项目依赖（gcc、SDL2、ffmpeg等）
      - name: Install dependencies
        run: |
          sudo apt update
          # 基础编译工具
          sudo apt install -y gcc git make
          # SDL2核心依赖（音频播放必需）
          sudo apt install -y libsdl2-dev libsdl2-alsa-dev
          # ffmpeg（音视频转换必需）
          sudo apt install -y ffmpeg

      # 步骤3：清理旧文件 + 编译项目（核心步骤，删除了./configure）
      - name: Build project
        run: |
          make clean  # 清理残留编译文件
          make        # 用Makefile编译，自动处理音视频转换和代码编译

      # 步骤4：可选测试（如果需要在Action中运行播放，可保留；仅编译验证可删除）
      - name: Test build (optional)
        run: |
          echo "编译完成，生成的可执行文件：$(ls -l bad-apple-sync)"
          # 注：GitHub Action环境无音频输出，无法实际播放，仅验证编译成功即可
